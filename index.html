<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latihan Uji Kompetensi Terapis Gigi dan Mulut</title>
    <!-- Local Tailwind CSS build -->
    <link href="./dist/output.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .vignette {
            background-color: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 12px;
            margin-bottom: 12px;
            color: #0c4a6e;
        }
        .question-text {
            font-weight: 600;
            margin-bottom: 16px;
        }
        .options-container {
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 0.4s ease-out, transform 0.4s ease-out;
            pointer-events: none;
        }
        .options-container.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        .option-label {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .option-label:hover {
            background-color: #f3f4f6;
        }
        .option-label.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .option-label.correct {
            background-color: #dcfce7 !important;
            border-color: #22c55e !important;
        }
        .option-label.incorrect {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
        }
        .timer-warning {
            color: #ef4444;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .nav-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .nav-btn:hover {
            background-color: #e5e7eb;
        }
        .nav-btn.answered {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .nav-btn.answered.correct-nav {
            background-color: #22c55e;
            border-color: #22c55e;
        }
        .nav-btn.answered.incorrect-nav {
            background-color: #ef4444;
            border-color: #ef4444;
        }
        .nav-btn.current {
            background-color: #1f2937;
            color: white;
            border-color: #1f2937;
            transform: scale(1.1);
        }
        .explanation-box {
            margin-top: 16px;
            padding: 16px;
            border-radius: 8px;
            background-color: #f0f9ff;
            border-left: 4px solid #0ea5e9;
        }
        .filter-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #334155;
            margin-bottom: 4px;
        }
        .filter-select {
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #ai-prompt-screen {
            background-color: rgba(0,0,0,0.5);
        }
        .question-count-badge {
            transition: all 0.3s ease;
        }
        .question-count-badge.updated {
            animation: pulse-scale 0.5s ease-in-out;
        }
        @keyframes pulse-scale {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div id="main-container" class="max-w-7xl mx-auto p-4 md:p-6">
        
        <div id="header" class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Latihan Uji Kompetensi</h1>
            <p class="text-slate-600 mt-2">Terapis Gigi dan Mulut</p>
        </div>

        <!-- Start Screen -->
        <div id="start-screen" class="bg-white p-8 rounded-xl shadow-lg max-w-5xl mx-auto">
            <h2 class="text-2xl font-semibold mb-6 border-b pb-4">Pengaturan Latihan Sesuai Blueprint</h2>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Filter Columns -->
                <div id="filter-tinjauan-1">
                    <label for="filter-1" class="filter-label font-bold">Tinjauan 1: Area Kompetensi</label>
                    <select id="filter-1" class="filter-select"></select>
                </div>
                <div id="filter-tinjauan-2">
                    <label for="filter-2" class="filter-label font-bold">Tinjauan 2: Ranah Pembelajaran</label>
                    <select id="filter-2" class="filter-select"></select>
                </div>
                <div id="filter-tinjauan-3">
                    <label for="filter-3" class="filter-label font-bold">Tinjauan 3: Jenis Soal</label>
                    <select id="filter-3" class="filter-select"></select>
                </div>
                <div id="filter-tinjauan-4">
                    <label for="filter-4" class="filter-label font-bold">Tinjauan 4: Profil</label>
                    <select id="filter-4" class="filter-select"></select>
                </div>
                <div id="filter-tinjauan-5">
                    <label for="filter-5" class="filter-label font-bold">Tinjauan 5: Kegiatan/Tindakan</label>
                    <select id="filter-5" class="filter-select"></select>
                </div>
                 <div id="filter-tinjauan-6">
                    <label for="filter-6" class="filter-label font-bold">Tinjauan 6: Jenis Pekerjaan</label>
                    <select id="filter-6" class="filter-select"></select>
                </div>
                 <div id="filter-tinjauan-7">
                    <label for="filter-7" class="filter-label font-bold">Tinjauan 7: Sasaran</label>
                    <select id="filter-7" class="filter-select"></select>
                </div>

                <!-- Settings Column -->
                <div class="lg:col-span-3 grid md:grid-cols-2 gap-6 border-t pt-6 mt-6">
                     <div>
                        <h3 class="text-lg font-bold mb-3">Atur Sesi Latihan</h3>
                        <div class="space-y-4 text-left">
                            <div>
                                <label for="question-count" class="block text-sm font-medium text-slate-700">Jumlah Soal (Maks. 180)</label>
                                <input type="number" id="question-count" value="60" min="10" max="180" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2">
                            </div>
                            <div>
                                <label for="time-limit" class="block text-sm font-medium text-slate-700">Waktu Ujian (Menit, Maks. 180)</label>
                                <input type="number" id="time-limit" value="60" min="10" max="180" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2">
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold mb-3">Pilih Mode & Mulai</h3>
                         <div class="flex flex-col gap-4 justify-start">
                            <button id="exam-mode-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors shadow-md">
                                Mulai Mode Ujian
                            </button>
                            <button id="learn-mode-btn" class="w-full bg-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-700 transition-colors shadow-md">
                                Mulai Mode Belajar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Shared Storage Configuration -->
            <div class="mt-4 bg-blue-50 rounded-lg p-4 border border-blue-200">
                <h3 class="text-sm font-bold text-blue-800 mb-2">üåê Shared Question Bank</h3>
                <div class="grid md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <label class="block text-blue-700 font-medium mb-1">Group ID:</label>
                        <input type="text" id="shared-storage-id" class="w-full px-3 py-2 border border-blue-300 rounded text-sm" placeholder="Contoh: TGM-BATCH-2025">
                        <p class="text-xs text-blue-600 mt-1">Gunakan ID yang sama untuk berbagi soal AI antar browser/pengguna</p>
                    </div>
                    <div class="flex items-end">
                        <button id="sync-shared-storage" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                            üîÑ Sync Bank Soal
                        </button>
                    </div>
                </div>
                <div class="mt-2 text-xs text-blue-600">
                    <span id="sync-status">üí° Masukkan Group ID dan klik Sync untuk berbagi soal AI</span>
                </div>
                <div class="mt-2 text-xs text-gray-600">
                    <strong>Cara berbagi:</strong> 1) Generate soal AI ‚Üí 2) Masukkan Group ID ‚Üí 3) Klik Sync ‚Üí 4) Bagikan Group ID ke tim
                </div>
            </div>
            <div class="mt-6 bg-slate-50 rounded-lg p-4 border border-slate-200">
                <div class="grid md:grid-cols-2 gap-4 text-sm">
                    <div class="flex items-center justify-between">
                        <span class="text-slate-600 font-medium">üìä Total Bank Soal:</span>
                        <span id="total-questions-count" class="question-count-badge text-slate-900 font-bold bg-white px-2 py-1 rounded">480</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-slate-600 font-medium">üîç Soal Sesuai Filter:</span>
                        <span id="filtered-questions-count" class="question-count-badge text-blue-600 font-bold bg-white px-2 py-1 rounded">-</span>
                    </div>
                </div>
                <div class="mt-2 text-xs flex justify-between items-center">
                    <span id="questions-info-text" class="text-slate-500">Pilih filter untuk melihat jumlah soal yang tersedia</span>
                    <div class="flex gap-2">
                        <button id="export-ai-questions" class="text-blue-500 hover:text-blue-700 text-xs underline" style="display: none;">Export Soal AI</button>
                        <button id="export-google-sheets" class="text-green-500 hover:text-green-700 text-xs underline" style="display: none;">üìä Export ke Google Sheets</button>
                        <button id="import-ai-questions" class="text-green-500 hover:text-green-700 text-xs underline">Import Soal AI</button>
                        <button id="import-google-sheets" class="text-teal-500 hover:text-teal-700 text-xs underline">üìä Import dari Google Sheets</button>
                        <button id="setup-google-api" class="text-purple-500 hover:text-purple-700 text-xs underline">üîß Setup Google API</button>
                        <button id="share-to-cloud" class="text-purple-500 hover:text-purple-700 text-xs underline" style="display: none;">Share ke Cloud</button>
                        <button id="load-from-cloud" class="text-indigo-500 hover:text-indigo-700 text-xs underline">Load dari Cloud</button>
                        <button id="generate-qr" class="text-orange-500 hover:text-orange-700 text-xs underline" style="display: none;">QR Code</button>
                        <button id="clear-ai-questions" class="text-red-500 hover:text-red-700 text-xs underline" style="display: none;">Hapus Soal AI</button>
                    </div>
                </div>
            </div>
            
             <p id="error-message" class="text-red-500 mt-4 text-sm font-semibold h-5"></p>
        </div>

        <!-- AI Prompt Screen -->
        <div id="ai-prompt-screen" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
            <div class="bg-white p-8 rounded-xl shadow-lg text-center max-w-lg mx-auto">
                <h2 class="text-2xl font-semibold mb-4">Soal Tidak Ditemukan</h2>
                <p class="mb-6 text-slate-600">Bank soal kami tidak memiliki soal yang cocok dengan kombinasi filter Anda. Apa yang ingin Anda lakukan?</p>
                <div class="flex flex-col gap-4">
                    <button id="generate-ai-btn" class="w-full bg-purple-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-purple-700 transition-colors shadow-md flex items-center justify-center">
                        <span class="btn-text">Buat Soal Baru dengan AI</span>
                        <div class="loader hidden ml-3"></div>
                    </button>
                    <button id="change-filter-btn" class="w-full bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition-colors">
                        Ubah Filter
                    </button>
                </div>
            </div>
        </div>


        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden md:grid md:grid-cols-3 lg:grid-cols-4 gap-6">
            <!-- Left Panel (Navigation) -->
            <div class="md:col-span-1 lg:col-span-1 bg-white p-4 rounded-xl shadow-lg h-fit sticky top-6">
                <button id="back-to-menu-btn" class="w-full mb-4 bg-gray-200 text-slate-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors">
                    &larr; Kembali ke Menu
                </button>
                <h3 class="text-lg font-bold text-center mb-4">Navigasi Soal</h3>
                <div id="navigation-menu" class="grid grid-cols-6 gap-2"></div>
            </div>
            
            <!-- Right Panel (Question & Timer) -->
            <div class="md:col-span-2 lg:col-span-3">
                <div id="timer-header" class="sticky top-6 bg-white/80 backdrop-blur-sm z-10 p-4 mb-6 rounded-xl shadow-md flex justify-between items-center">
                    <h2 id="question-counter" class="text-xl font-bold text-slate-900">Soal 1 dari 60</h2>
                    <div id="timer" class="text-2xl font-bold bg-slate-200 text-slate-800 px-4 py-2 rounded-lg">60:00</div>
                </div>

                <div id="question-container" class="bg-white p-6 rounded-xl shadow-md min-h-[300px]"></div>

                <div class="mt-6 flex justify-between items-center">
                    <button id="prev-btn" class="bg-gray-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-gray-700 transition-colors">Sebelumnya</button>
                    <button id="submit-btn" class="bg-green-600 text-white font-bold py-3 px-12 rounded-lg hover:bg-green-700 transition-colors shadow-lg">Selesai</button>
                    <button id="next-btn" class="bg-blue-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-blue-700 transition-colors">Selanjutnya</button>
                </div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden bg-white p-8 rounded-xl shadow-lg max-w-4xl mx-auto">
            <h2 class="text-3xl font-bold text-center mb-2 text-slate-900">Latihan Selesai!</h2>
            <p id="score-text" class="text-center text-xl text-slate-600 mb-6">Skor Anda: 0 / 60</p>
            
            <div class="text-center mb-8">
                 <button id="review-btn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors">
                    Tinjau Jawaban
                </button>
                 <button id="restart-btn" class="bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-700 transition-colors ml-4">
                    Coba Lagi
                </button>
            </div>

            <div id="review-container" class="hidden mt-8 space-y-6"></div>
        </div>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://apis.google.com/js/api.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    // === 1. KONFIGURASI SUPABASE ===
    // Ganti dengan URL dan anon key project Supabase Anda!
    const SUPABASE_URL = 'https://zsctdtrgrecgyfbrxaoo.supabase.co'; // <-- GANTI!
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpzY3RkdHJncmVjZ3lmYnJ4YW9vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI4MDY4ODYsImV4cCI6MjA2ODM4Mjg4Nn0.x3zOj9u3wxoeSi-4YDUjZoiT9xjTfNmaSOQ9H03QRNM'; // <-- GANTI!
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // === 2. CRUD SOAL SUPABASE ===
    async function fetchQuestionsFromSupabase() {
        const { data, error } = await supabase
            .from('questions')
            .select('*')
            .order('id', { ascending: true });
        if (error) {
            alert('Gagal mengambil soal dari database Supabase!');
            console.error(error);
            return [];
        }
        return data;
    }
    async function addQuestionToSupabase(questionObj) {
        const { data, error } = await supabase
            .from('questions')
            .insert([questionObj]);
        if (error) {
            alert('Gagal menambah soal ke database!');
            console.error(error);
            return null;
        }
        return data[0];
    }
    async function updateQuestionInSupabase(id, updateObj) {
        const { data, error } = await supabase
            .from('questions')
            .update(updateObj)
            .eq('id', id);
        if (error) {
            alert('Gagal mengedit soal!');
            console.error(error);
            return null;
        }
        return data[0];
    }
    async function deleteQuestionFromSupabase(id) {
        const { error } = await supabase
            .from('questions')
            .delete()
            .eq('id', id);
        if (error) {
            alert('Gagal menghapus soal!');
            console.error(error);
            return false;
        }
        return true;
    }

// TINJAUAN 1: Area Kompetensi
const areaKompetensi = [
  "Profesionalisme dan Kepatuhan Hukum",
  "Keterampilan Sosial, Komunikasi dan Pengelolaan Informasi",
  "Berpikir Kritis dan Pengembangan Diri",
  "Landasan Ilmiah Ilmu Asuhan Kesehatan Gigi dan Mulut",
  "Keterampilan Klinis Asuhan Kesehatan Gigi dan Mulut",
  "Pengelolaan Asuhan Kesehatan Gigi dan Mulut"
];

// TINJAUAN 2: Ranah Taksonomi Pembelajaran
const ranahPembelajaran = [
  "Kognitif",
  "Procedural Knowledge",
  "Afektif/konatif"
];

// TINJAUAN 3: Jenis Soal
const jenisSoal = [
  "Recalling",
  "Reasoning"
];

// TINJAUAN 4: Profil
const profil = [
  "Pelaksana pelayanan asuhan kesehatan gigi dan mulut",
  "Pelaksana promosi kesehatan gigi dan mulut",
  "Pelaksana kegiatan asistensi pelayanan kesehatan gigi"
];

// TINJAUAN 5: Kegiatan/Tindakan
const kegiatanTindakan = [
  "Ekstraksi",
  "Scalling",
  "Filling",
  "Fissure sealing/Surface Protection",
  "Aplikasi fluor",
  "Dental health education",
  "Oral fisioterapi",
  "Komunikasi Terapeutik",
  "Pemeliharaan alat-alat kedokteran gigi",
  "Pengendalian Infeksi Silang",
  "Manajemen Klinik",
  "Four handed dentistry",
  "Manajemen UKGS",
  "Manajemen Kesehatan Gigi dan Mulut Masyarakat",
  "Tindakan kegawatdaruratan dalam keperawatan gigi",
  "Tindakan kolaboratif/rujukan",
  "Pengkajian"
];

// TINJAUAN 6: Jenis Pekerjaan
const jenisPekerjaan = [
  "Dental assisting",
  "Dental hygiene",
  "Dental therapy"
];

// TINJAUAN 7: Sasaran
const sasaran = [
  "Individu",
  "Kelompok",
  "Masyarakat"
];

// Debug: Pastikan array dan elemen select sudah ada
console.log("Area Kompetensi:", areaKompetensi);
console.log("Select 1:", document.getElementById('filter-1'));

function populateDropdown(id, options) {
  const select = document.getElementById(id);
  if (!select) return;
  select.innerHTML = '<option value="">-- Pilih --</option>';
  options.forEach(opt => {
    select.innerHTML += `<option value="${opt}">${opt}</option>`;
  });
}

document.addEventListener('DOMContentLoaded', async () => {
        // === 3. GANTI SUMBER DATA: allQuizData dari Supabase ===
        const allQuizData = [];
        // Ambil soal dari Supabase saat aplikasi mulai
        const supabaseQuestions = await fetchQuestionsFromSupabase();
        allQuizData.push(...supabaseQuestions);

        // Isi dropdown filter sesuai 7 tinjauan
    populateDropdown('filter-1', areaKompetensi);
    populateDropdown('filter-2', ranahPembelajaran);
    populateDropdown('filter-3', jenisSoal);
    populateDropdown('filter-4', profil);
    populateDropdown('filter-5', kegiatanTindakan);
    populateDropdown('filter-6', jenisPekerjaan);
    populateDropdown('filter-7', sasaran);

        // Contoh: updateQuestionCount() tetap jalan
        // ...existing code...

        // Jika ingin menambah soal baru ke Supabase:
        // await addQuestionToSupabase({...});

        // Jika ingin edit/hapus, gunakan updateQuestionInSupabase dan deleteQuestionFromSupabase

        // ...existing code...
// Panggil init() seperti biasa
// init(); // HAPUS atau KOMENTARI baris ini jika tidak ada fungsi init()
// ...existing code...
    });
    // === FORM CRUD SOAL SEDERHANA (ADMIN) ===
    // Tambahkan form CRUD di bawah halaman (atau di modal sesuai kebutuhan)
    const crudFormHtml = `
    <div id="crud-form-container" style="margin:32px 0; padding:24px; background:#f8fafc; border-radius:12px; max-width:600px;">
      <h3 style="font-weight:bold; margin-bottom:12px;">Tambah/Edit Soal (Admin)</h3>
      <input id="crud-id" type="hidden">
      <div style="margin-bottom:8px;">
        <input id="crud-question" type="text" placeholder="Pertanyaan" style="width:100%;padding:8px;">
      </div>
      <div style="margin-bottom:8px;">
        <input id="crud-vignette" type="text" placeholder="Vignette (opsional)" style="width:100%;padding:8px;">
      </div>
      <div style="margin-bottom:8px;">
        <input id="crud-options" type="text" placeholder="Opsi (pisahkan dengan ;)" style="width:100%;padding:8px;">
      </div>
      <div style="margin-bottom:8px;">
        <input id="crud-answer" type="text" placeholder="Jawaban Benar (misal: A)" style="width:100%;padding:8px;">
      </div>
      <div style="margin-bottom:8px;">
        <input id="crud-explanation" type="text" placeholder="Penjelasan" style="width:100%;padding:8px;">
      </div>
      <button id="crud-save-btn" style="background:#2563eb;color:#fff;padding:8px 16px;border-radius:6px;">Simpan</button>
      <button id="crud-clear-btn" style="background:#64748b;color:#fff;padding:8px 16px;border-radius:6px;margin-left:8px;">Clear</button>
    </div>
    <div id="crud-list-container" style="margin:24px 0;"></div>
    `;
    document.body.insertAdjacentHTML('beforeend', crudFormHtml);

    // Tampilkan semua soal di bawah form
    async function renderCrudList() {
        const questions = await fetchQuestionsFromSupabase();
        let html = '<table border="1" cellpadding="6" style="width:100%;margin-top:12px;"><tr><th>ID</th><th>Pertanyaan</th><th>Aksi</th></tr>';
        questions.forEach(q => {
            html += `<tr>
                <td>${q.id}</td>
                <td>${q.question}</td>
                <td>
                    <button onclick="editCrudSoal(${q.id})" style="background:#f59e42;color:#fff;padding:4px 10px;border-radius:4px;">Edit</button>
                    <button onclick="deleteCrudSoal(${q.id})" style="background:#ef4444;color:#fff;padding:4px 10px;border-radius:4px;margin-left:6px;">Hapus</button>
                </td>
            </tr>`;
        });
        html += '</table>';
        document.getElementById('crud-list-container').innerHTML = html;
    }
    window.editCrudSoal = async function(id) {
        const questions = await fetchQuestionsFromSupabase();
        const q = questions.find(q => q.id === id);
        if (!q) return;
        document.getElementById('crud-id').value = q.id;
        document.getElementById('crud-question').value = q.question;
        document.getElementById('crud-vignette').value = q.vignette || '';
        document.getElementById('crud-options').value = (q.options || []).join(';');
        document.getElementById('crud-answer').value = q.answer || '';
        document.getElementById('crud-explanation').value = q.explanation || '';
    };
    window.deleteCrudSoal = async function(id) {
        if (confirm('Yakin hapus soal ini?')) {
            await deleteQuestionFromSupabase(id);
            renderCrudList();
        }
    };
    document.getElementById('crud-save-btn').onclick = async function() {
        const id = document.getElementById('crud-id').value;
        const question = document.getElementById('crud-question').value;
        const vignette = document.getElementById('crud-vignette').value;
        const options = document.getElementById('crud-options').value.split(';').map(o=>o.trim());
        const answer = document.getElementById('crud-answer').value;
        const explanation = document.getElementById('crud-explanation').value;
        const soalObj = { question, vignette, options, answer, explanation };
        if (id) {
            await updateQuestionInSupabase(Number(id), soalObj);
        } else {
            await addQuestionToSupabase(soalObj);
        }
        document.getElementById('crud-id').value = '';
        document.getElementById('crud-question').value = '';
        document.getElementById('crud-vignette').value = '';
        document.getElementById('crud-options').value = '';
        document.getElementById('crud-answer').value = '';
        document.getElementById('crud-explanation').value = '';
        renderCrudList();
    };
    document.getElementById('crud-clear-btn').onclick = function() {
        document.getElementById('crud-id').value = '';
        document.getElementById('crud-question').value = '';
        document.getElementById('crud-vignette').value = '';
        document.getElementById('crud-options').value = '';
        document.getElementById('crud-answer').value = '';
        document.getElementById('crud-explanation').value = '';
    };
    renderCrudList();
//
</script>
